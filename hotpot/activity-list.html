<!doctype html>
<html ng-app="hotpotApp">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0">
  <title>activity-list</title>
  <link rel="stylesheet" href="css/standardize.css">
  <link rel="stylesheet" href="css/activity-list.css">
  <style>
    body {
      font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', 'STHeiti';
    }
    ._input {
      width: calc(100% - 52px);
    }
  </style>
</head>

<body class="body activity-list clearfix" ng-controller="activityListCtrl">
  <div class="element clearfix">
    <p class="text">活动列表</p>
    <img class="image image-1" src="images/back.png">
    <img class="image image-2" src="images/filter.png">
    <img class="image image-3" src="images/add.png">
  </div>
  <collapsed-list-item ng-repeat="activity in activities.v" class="list-item clearfix">
    <div class="title clearfix">
      <img class="image image-4" src="images/jigsaw2.png">
      <img class="image image-5" src="images/jigsaw.png">
      <p class="text text-2" ng-bind="activity.name"></p>
      <p class="text text-3">3天后</p>
      <p class="text text-4"><span ng-bind="activity.people_count"></span>/<span ng-bind="activity.limit_count"></span>
      </p>
      <button class="_button">退出</button>
    </div>
    <div style="display:none" class="content clearfix" tag="{{activity.id}}">
      <img class="image" src="images/jigsaw3.png">
      <p class="text" ng-bind="activity.content"></p>
      <img class="image image-7" src="images/jigsaw4.png">
    </div>
  </collapsed-list-item>

  <script type="text/ng-template" id="collapsedListItemTemplate.htm">
  </script>

  <script src="js/jquery-min.js"></script>
  <script src="js/angular.min.js"></script>
  <script src="js/angular-resource.min.js"></script>
  <script>
    angular.module('hotpotApp', ['ngResource'])
      .controller('activityListCtrl', ['$scope', '$resource',
        function($scope, $resource) {
          $scope.activities = $resource(
            'http://testes.duapp.com/index.php/activity/activitylist', {}, {
              query: {
                method: 'GET'
              }
            }).query();
        }
      ])
      .directive('collapsedListItem', ['$resource',
        function($resource) {
          return {
            restrict: 'EA',
            //                templateUrl: 'collapsedListItemTemplate.htm',
            link: function(scope, el, attrs) {
              $('.title', el).on('click tap', function() {
                angular.element('.content').filter(function() {
                    return angular.element(this).css('display') != 'none';
                }).toggle('normal');
                angular.element('.content', el).toggle('normal');
              });
            }

          };
        }
      ]);
  </script>
</body>

</html>
